<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Template Creator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
    }
    #templateContainer {
      position: relative;
      display: inline-block;
    }
    #templateImage {
      max-width: 100%;
    }
    .box {
      border: 2px dashed yellow;
      position: absolute;
      resize: both;
      overflow: hidden;
      min-width: 30px;
      min-height: 30px;
    }
    .label {
      background: yellow;
      color: black;
      font-size: 12px;
      padding: 2px;
      display: inline-block;
    }
    .drag-handle {
      width: 20px;
      height: 20px;
      background: yellow;
      color: black;
      font-weight: bold;
      text-align: center;
      line-height: 20px;
      position: absolute;
      bottom: 0;
      right: 0;
      cursor: move;
    }
    .template-box-input {
      margin-bottom: 10px;
    }
    canvas {
      display: none;
    }
  </style>
</head>
<body>
  <h2>Template Creator</h2>
  <input type="file" id="imageUploader" accept="image/*" />
  <input type="text" id="templateName" placeholder="Template Name" />
  <button onclick="addNewBox()">Add New Box</button>
  <button onclick="saveTemplate()">Save Template</button>
  <button onclick="loadTemplates()">Load Template</button>
  <button onclick="generateTextInputs()">Generate Text</button>
  <button onclick="downloadImage()">Download</button>  <div id="inputFields"></div>  <div id="templateContainer">
    <img id="templateImage" />
  </div><canvas id="previewCanvas"></canvas>

  <script>
    const templateContainer = document.getElementById("templateContainer");
    const templateImage = document.getElementById("templateImage");
    const inputFields = document.getElementById("inputFields");
    const canvas = document.getElementById("previewCanvas");
    let boxes = [];

    document.getElementById("imageUploader").addEventListener("change", function (e) {
      const reader = new FileReader();
      reader.onload = function (event) {
        templateImage.src = event.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    });

    function makeDraggable(box) {
      const dragHandle = box.querySelector(".drag-handle");
      dragHandle.addEventListener("mousedown", function (e) {
        e.preventDefault();
        const offsetX = e.clientX - box.offsetLeft;
        const offsetY = e.clientY - box.offsetTop;

        function mouseMoveHandler(e) {
          box.style.left = e.clientX - offsetX + "px";
          box.style.top = e.clientY - offsetY + "px";
        }

        function mouseUpHandler() {
          document.removeEventListener("mousemove", mouseMoveHandler);
          document.removeEventListener("mouseup", mouseUpHandler);
        }

        document.addEventListener("mousemove", mouseMoveHandler);
        document.addEventListener("mouseup", mouseUpHandler);
      });
    }

    function addNewBox() {
      const name = prompt("Enter box label name:");
      if (!name) return;

      const box = document.createElement("div");
      box.className = "box";
      box.style.left = "50px";
      box.style.top = "50px";
      box.style.width = "100px";
      box.style.height = "50px";

      const label = document.createElement("div");
      label.className = "label";
      label.textContent = name;

      const dragHandle = document.createElement("div");
      dragHandle.className = "drag-handle";
      dragHandle.textContent = "+";

      box.appendChild(label);
      box.appendChild(dragHandle);
      templateContainer.appendChild(box);
      makeDraggable(box);

      boxes.push({ name, element: box });
    }

    function saveTemplate() {
      const name = document.getElementById("templateName").value;
      if (!name) return alert("Enter a template name");

      const data = {
        image: templateImage.src,
        boxes: boxes.map((b) => ({
          name: b.name,
          left: b.element.style.left,
          top: b.element.style.top,
          width: b.element.style.width,
          height: b.element.style.height
        }))
      };

      localStorage.setItem("template-" + name, JSON.stringify(data));
      alert("Template saved");
    }

    function loadTemplates() {
      inputFields.innerHTML = "";
      const keys = Object.keys(localStorage).filter(k => k.startsWith("template-"));
      const list = document.createElement("ul");
      keys.forEach(key => {
        const li = document.createElement("li");
        const btn = document.createElement("button");
        btn.textContent = key.replace("template-", "");
        btn.onclick = () => loadTemplate(key);
        li.appendChild(btn);
        list.appendChild(li);
      });
      inputFields.appendChild(list);
    }

    function loadTemplate(key) {
      const data = JSON.parse(localStorage.getItem(key));
      templateImage.src = data.image;
      boxes.forEach(b => b.element.remove());
      boxes = [];
      data.boxes.forEach(info => {
        const box = document.createElement("div");
        box.className = "box";
        box.style.left = info.left;
        box.style.top = info.top;
        box.style.width = info.width;
        box.style.height = info.height;

        const label = document.createElement("div");
        label.className = "label";
        label.textContent = info.name;

        const dragHandle = document.createElement("div");
        dragHandle.className = "drag-handle";
        dragHandle.textContent = "+";

        box.appendChild(label);
        box.appendChild(dragHandle);
        templateContainer.appendChild(box);
        makeDraggable(box);
        boxes.push({ name: info.name, element: box });
      });
      generateTextInputs();
    }

    function generateTextInputs() {
      inputFields.innerHTML = "";
      boxes.forEach((box, index) => {
        const div = document.createElement("div");
        div.className = "template-box-input";
        const label = document.createElement("label");
        label.textContent = box.name + ": ";
        const input = document.createElement("input");
        input.type = "text";
        input.id = "input-" + index;
        div.appendChild(label);
        div.appendChild(input);
        inputFields.appendChild(div);
      });
    }

    function downloadImage() {
      const width = templateImage.width;
      const height = templateImage.height;
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(templateImage, 0, 0, width, height);

      boxes.forEach((box, index) => {
        const input = document.getElementById("input-" + index);
        if (!input) return;
        const left = parseInt(box.element.style.left);
        const top = parseInt(box.element.style.top);
        const fontSize = 14;
        ctx.font = `${fontSize}px Arial`;
        ctx.fillStyle = "black";
        ctx.fillText(input.value, left + 5, top + fontSize + 5);
      });

      const link = document.createElement("a");
      link.download = "filled_template.png";
      link.href = canvas.toDataURL();
      link.click();
    }
  </script></body>
</html>