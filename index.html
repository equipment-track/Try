<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Template Box Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f2f5;
      color: #333;
    }
    .container {
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    .template-area {
      position: relative;
      display: inline-block;
      border: 2px solid #ccc;
    }
    .highlight-box {
      position: absolute;
      border: 2px dashed yellow;
      resize: both;
      overflow: auto;
      padding: 2px;
      min-width: 50px;
      min-height: 20px;
    }
    .highlight-box .drag-handle {
      cursor: move;
      background: yellow;
      color: black;
      font-weight: bold;
      font-size: 12px;
      padding: 2px 4px;
      position: absolute;
      top: -14px;
      left: 0;
    }
    .input-section, .output-section {
      margin-top: 20px;
      padding: 10px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    input, select {
      margin-bottom: 10px;
      padding: 6px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    label {
      font-weight: bold;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 16px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #0056b3;
    }
    canvas {
      margin-top: 20px;
      max-width: 100%;
    }
    .template-list {
      margin-top: 10px;
    }
    .template-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f9f9f9;
      border: 1px solid #ddd;
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    .template-item span {
      font-weight: bold;
    }
    .template-item button {
      background: #dc3545;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Template Box Editor</h2>
    <input type="file" id="imageUpload" accept="image/*" />
    <div class="controls">
      <input type="text" id="boxName" placeholder="Enter box name before adding" />
      <button onclick="addBox()">Add Box</button>
      <input type="text" id="templateName" placeholder="Template name" />
      <button onclick="saveTemplate()">Save Template</button>
      <button onclick="loadTemplates()">Load Templates</button>
    </div>
    <div class="template-area" id="templateArea"></div><div class="template-list" id="templateList"></div>

<div class="input-section" id="inputFields"></div>
<button onclick="generateText()">Generate Text</button>
<canvas id="outputCanvas"></canvas>
<button onclick="downloadImage()">Download</button>

  </div>  <script>
    let image = new Image();
    let boxes = [];
    let imageURL = '';

    document.getElementById('imageUpload').addEventListener('change', function (e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function (event) {
        imageURL = event.target.result;
        image.onload = () => {
          renderImage();
        };
        image.src = imageURL;
      };
      reader.readAsDataURL(file);
    });

    function renderImage() {
      const area = document.getElementById('templateArea');
      area.innerHTML = '';
      area.style.width = image.width + 'px';
      area.style.height = image.height + 'px';
      area.appendChild(image);
      boxes.forEach((box) => createBox(box));
    }

    function createBox(box) {
      const div = document.createElement('div');
      div.className = 'highlight-box';
      div.contentEditable = false;
      div.style.left = box.left + 'px';
      div.style.top = box.top + 'px';
      div.style.width = box.width + 'px';
      div.style.height = box.height + 'px';
      div.setAttribute('data-name', box.name);

      const drag = document.createElement('div');
      drag.className = 'drag-handle';
      drag.textContent = '+';
      div.appendChild(drag);

      drag.addEventListener('mousedown', dragStart);
      drag.addEventListener('touchstart', dragStart);

      div.addEventListener('mouseup', () => updateBoxPosition(div));
      div.addEventListener('touchend', () => updateBoxPosition(div));

      document.getElementById('templateArea').appendChild(div);
    }

    function dragStart(e) {
      e.preventDefault();
      const box = e.target.parentElement;
      const shiftX = e.clientX - box.getBoundingClientRect().left;
      const shiftY = e.clientY - box.getBoundingClientRect().top;

      function moveAt(pageX, pageY) {
        box.style.left = pageX - shiftX + 'px';
        box.style.top = pageY - shiftY + 'px';
      }

      function onMouseMove(e) {
        moveAt(e.pageX, e.pageY);
      }

      document.addEventListener('mousemove', onMouseMove);

      box.onmouseup = function () {
        document.removeEventListener('mousemove', onMouseMove);
        box.onmouseup = null;
      };
    }

    function updateBoxPosition(div) {
      const name = div.getAttribute('data-name');
      const rect = div.getBoundingClientRect();
      const parentRect = document.getElementById('templateArea').getBoundingClientRect();
      const left = rect.left - parentRect.left;
      const top = rect.top - parentRect.top;
      const width = rect.width;
      const height = rect.height;

      const box = boxes.find((b) => b.name === name);
      if (box) {
        box.left = left;
        box.top = top;
        box.width = width;
        box.height = height;
      }
    }

    function addBox() {
      const name = document.getElementById('boxName').value.trim();
      if (!name) return alert('Enter a name for the box.');
      const box = { name, left: 20, top: 20, width: 100, height: 50 };
      boxes.push(box);
      createBox(box);
      document.getElementById('boxName').value = '';
    }

    function saveTemplate() {
      const name = document.getElementById('templateName').value.trim();
      if (!name) return alert('Enter template name.');
      const data = {
        imageURL,
        boxes,
      };
      localStorage.setItem('template_' + name, JSON.stringify(data));
      alert('Template saved!');
      loadTemplates();
    }

    function loadTemplates() {
      const list = document.getElementById('templateList');
      list.innerHTML = '';
      Object.keys(localStorage).forEach((key) => {
        if (key.startsWith('template_')) {
          const name = key.replace('template_', '');
          const item = document.createElement('div');
          item.className = 'template-item';
          item.innerHTML = `<span>${name}</span>`;

          const loadBtn = document.createElement('button');
          loadBtn.textContent = 'Load';
          loadBtn.onclick = () => {
            const data = JSON.parse(localStorage.getItem(key));
            imageURL = data.imageURL;
            boxes = data.boxes;
            image.src = imageURL;
            image.onload = renderImage;
            showInputs();
          };

          const delBtn = document.createElement('button');
          delBtn.textContent = 'Delete';
          delBtn.onclick = () => {
            if (confirm('Are you sure to delete this template?')) {
              localStorage.removeItem(key);
              loadTemplates();
            }
          };

          item.appendChild(loadBtn);
          item.appendChild(delBtn);
          list.appendChild(item);
        }
      });
    }

    function showInputs() {
      const inputDiv = document.getElementById('inputFields');
      inputDiv.innerHTML = '';
      boxes.forEach((b) => {
        const label = document.createElement('label');
        label.textContent = b.name;
        const input = document.createElement('input');
        input.setAttribute('data-name', b.name);
        inputDiv.appendChild(label);
        inputDiv.appendChild(input);
      });
    }

    function generateText() {
      const canvas = document.getElementById('outputCanvas');
      canvas.width = image.width;
      canvas.height = image.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(image, 0, 0);

      boxes.forEach((box) => {
        const input = document.querySelector(`input[data-name='${box.name}']`);
        ctx.fillStyle = 'black';
        ctx.font = '16px Arial';
        ctx.textAlign = 'left';
        ctx.fillText(input.value || '', box.left + 5, box.top + 20);
      });
    }

    function downloadImage() {
      const link = document.createElement('a');
      link.download = 'output.png';
      link.href = document.getElementById('outputCanvas').toDataURL();
      link.click();
    }
  </script></body>
</html>