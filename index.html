<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Template Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f0f0f0;
    }
    #controls, #inputSection {
      margin: 10px;
    }
    #canvasWrapper {
      position: relative;
      border: 1px solid #ccc;
      width: fit-content;
      overflow: hidden;
    }
    #templateImage {
      display: block;
      max-width: 100%;
    }
    .box {
      position: absolute;
      border: 2px dashed yellow;
      background-color: rgba(255, 255, 0, 0.3);
      resize: both;
      overflow: auto;
      min-width: 30px;
      min-height: 30px;
    }
    .drag-handle {
      position: absolute;
      top: -10px;
      left: -10px;
      background: #ff0;
      color: #000;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: grab;
    }
    #inputSection label {
      display: block;
      margin: 5px 0 2px;
    }
    #templateList button {
      display: block;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div id="controls">
    <input type="file" id="uploadImage" accept="image/*" />
    <button onclick="addBox()">Add Box</button>
    <button onclick="saveTemplate()">Save Template</button>
    <button onclick="loadTemplateList()">Load Template</button>
    <button onclick="generateText()">Generate Text</button>
    <button onclick="downloadImage()">Download</button>
  </div>
  <div id="canvasWrapper">
    <img id="templateImage" />
  </div>
  <div id="inputSection"></div>
  <div id="templateList"></div>  <script>
    let currentBoxes = [];
    let templateName = "";

    document.getElementById('uploadImage').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (event) {
        document.getElementById('templateImage').src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    function addBox() {
      const name = prompt("Enter Box Name:");
      if (!name) return;

      const box = document.createElement('div');
      box.className = 'box';
      box.style.left = '50px';
      box.style.top = '50px';
      box.dataset.name = name;

      const handle = document.createElement('div');
      handle.className = 'drag-handle';
      handle.innerText = '+';
      box.appendChild(handle);

      handle.addEventListener('mousedown', startDrag);
      handle.addEventListener('touchstart', startDrag);

      document.getElementById('canvasWrapper').appendChild(box);
      currentBoxes.push(box);

      updateInputSection();
    }

    function updateInputSection() {
      const inputSection = document.getElementById('inputSection');
      inputSection.innerHTML = '';
      currentBoxes.forEach(box => {
        const label = document.createElement('label');
        label.innerText = box.dataset.name;
        const input = document.createElement('input');
        input.type = 'text';
        input.dataset.name = box.dataset.name;
        inputSection.appendChild(label);
        inputSection.appendChild(input);
      });
    }

    function saveTemplate() {
      templateName = prompt("Enter Template Name to Save:");
      if (!templateName) return;

      const imageSrc = document.getElementById('templateImage').src;
      const boxData = currentBoxes.map(box => ({
        name: box.dataset.name,
        left: box.style.left,
        top: box.style.top,
        width: box.offsetWidth,
        height: box.offsetHeight
      }));
      const template = { imageSrc, boxData };
      localStorage.setItem("template_" + templateName, JSON.stringify(template));
      alert("Template saved!");
    }

    function loadTemplateList() {
      const list = document.getElementById('templateList');
      list.innerHTML = '';
      for (let key in localStorage) {
        if (key.startsWith('template_')) {
          const btn = document.createElement('button');
          btn.innerText = key.replace('template_', '');
          btn.onclick = () => loadTemplate(key);
          list.appendChild(btn);
        }
      }
    }

    function loadTemplate(key) {
      const { imageSrc, boxData } = JSON.parse(localStorage.getItem(key));
      document.getElementById('templateImage').src = imageSrc;
      currentBoxes.forEach(b => b.remove());
      currentBoxes = [];

      boxData.forEach(data => {
        const box = document.createElement('div');
        box.className = 'box';
        box.style.left = data.left;
        box.style.top = data.top;
        box.style.width = data.width + 'px';
        box.style.height = data.height + 'px';
        box.dataset.name = data.name;

        const handle = document.createElement('div');
        handle.className = 'drag-handle';
        handle.innerText = '+';
        box.appendChild(handle);

        handle.addEventListener('mousedown', startDrag);
        handle.addEventListener('touchstart', startDrag);

        document.getElementById('canvasWrapper').appendChild(box);
        currentBoxes.push(box);
      });
      updateInputSection();
    }

    function generateText() {
      currentBoxes.forEach(box => {
        box.innerHTML = '';
        const handle = document.createElement('div');
        handle.className = 'drag-handle';
        handle.innerText = '+';
        box.appendChild(handle);

        handle.addEventListener('mousedown', startDrag);
        handle.addEventListener('touchstart', startDrag);

        const text = document.querySelector(`#inputSection input[data-name='${box.dataset.name}']`).value;
        const span = document.createElement('span');
        span.innerText = text;
        span.style.position = 'absolute';
        span.style.top = '30%';
        span.style.left = '5px';
        span.style.fontSize = '14px';
        box.appendChild(span);
      });
    }

    function downloadImage() {
      generateText();
      html2canvas(document.getElementById('canvasWrapper')).then(canvas => {
        const link = document.createElement('a');
        link.download = templateName + '.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    function startDrag(e) {
      e.preventDefault();
      const box = e.target.parentElement;
      const shiftX = (e.clientX || e.touches[0].clientX) - box.getBoundingClientRect().left;
      const shiftY = (e.clientY || e.touches[0].clientY) - box.getBoundingClientRect().top;

      function moveAt(pageX, pageY) {
        box.style.left = pageX - shiftX + 'px';
        box.style.top = pageY - shiftY + 'px';
      }

      function onMouseMove(e) {
        moveAt((e.clientX || e.touches[0].clientX), (e.clientY || e.touches[0].clientY));
      }

      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('touchmove', onMouseMove);

      function stopDrag() {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('touchmove', onMouseMove);
        document.removeEventListener('mouseup', stopDrag);
        document.removeEventListener('touchend', stopDrag);
      }

      document.addEventListener('mouseup', stopDrag);
      document.addEventListener('touchend', stopDrag);
    }
  </script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script></body>
</html>